function a(b){"@babel/helpers - typeof";return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a(b)}(function(a,b){if("function"==typeof define&&define.amd)define("assinare",["exports"],b);else if("undefined"!=typeof exports)b(exports);else{var c={exports:{}};b(c.exports),a.assinare=c.exports}})("undefined"==typeof globalThis?"undefined"==typeof self?this:self:globalThis,function(b){"use strict";function c(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&d(a,b)}function d(a,b){return d=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},d(a,b)}function e(a){var b=h();return function(){var c,d=i(a);if(b){var e=i(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return f(this,c)}}function f(b,c){return c&&("object"===a(c)||"function"==typeof c)?c:g(b)}function g(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function i(a){return i=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},i(a)}function j(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function k(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function l(a,b,c){return b&&k(a.prototype,b),c&&k(a,c),a}function m(a){var b=a.headers.get("Server");if(b&&b.startsWith("Assinare Daemon/")){var c=b.substring("Assinare Daemon/".length);if(!r.test(c))throw new Error("Vers\xE3o incompat\xEDvel do Assinare Daemon detectada");else if(!a.ok){if(500===a.status)return a.json().then(function(a){console.log(a);var b=new Error(a.message);throw Object.assign(b,a),b});if(a.statusText)throw new Error("Erro HTTP: ".concat(a.status," - ").concat(a.statusText));else throw new Error("Erro HTTP: ".concat(a.status))}else return a}else throw new Error("Assinare Daemon n\xE3o detectado")}function n(a,b){return fetch(a,b).catch(function(){throw new Error("Falha de comunica\xE7\xE3o com o Assinare Daemon")}).then(m)}function o(a,b){return n(a,b).then(function(a){return a.json()})}function p(a){return new Promise(function(b,c){if(a.status<2)a.onLoad=b;else if(a.status==2)b();else{var d="Applet event handler not registered because applet status is: "+a.status;c(new Error(d))}})}function q(a,b,c,d){if(d&&"function"!=typeof d)throw new Error("Instantiation callback is not a function");var e,f=c[a],g=document.getElementById(f);return e=f&&window.navigator.javaEnabled&&window.navigator.javaEnabled()&&g?p(g).then(function(){return g}):Promise.reject(!1),e=e.catch(function(a){a&&console.warn(a);var d=new b(c);return c.lazy?d:d.checkDaemonInfo().then(function(){return d})}),d?void e.then(function(a){d(null,a)}).catch(function(a){d(a,null)}):e}Object.defineProperty(b,"__esModule",{value:!0}),b.default=b.sign=b.id=void 0;var r=/^2\.[0-7]\.\d{1,2}(?:-SNAPSHOT)?$/,s=function(){function a(){j(this,a),this.host="localhost",this.port=20666,this.urlBase="https://".concat(this.host,":").concat(this.port)}return l(a,[{key:"_genericPOST",value:function _genericPOST(a,b,c){var d;if(c)if("function"==typeof c)d=c;else if(d=window[c],"function"!=typeof d)throw new Error("Function \"".concat(c.toString(),"\" not found on Window"));var e=o(this.urlBase+a,{method:"POST",body:JSON.stringify(b),headers:{"content-type":"application/json"}});return c?void e.then(function(a){console.log(a),d(!1,a)}).catch(function(a){console.error(a),d(a,null)}):e}},{key:"getDaemonInfo",value:function getDaemonInfo(){return o(this.urlBase+"/info")}},{key:"checkDaemonInfo",value:function checkDaemonInfo(){return this.getDaemonInfo().then(function(){return!0})}}]),a}(),t=function(a){function b(a){return j(this,b),d.call(this,a)}c(b,a);var d=e(b);return l(b,[{key:"getCitizenData",value:function getCitizenData(a){return this._genericPOST("/id/data",{a:1},a)}},{key:"getCitizenAddress",value:function getCitizenAddress(a){return this._genericPOST("/id/address",{a:1},a)}},{key:"getCitizenPicture",value:function getCitizenPicture(a){return this._genericPOST("/id/picture",{a:1},a)}},{key:"shutdown",value:function shutdown(a){return this._genericPOST("/shutdown",{a:1},a)}}]),b}(s),u=function(a){function b(a){var c;return j(this,b),c=d.call(this,a),c.getFileUrlPrefix=a.getFileUrlPrefix,c.getSignedFileUrlPrefix=a.getSignedFileUrlPrefix,c.putFileUrl=a.putFileUrl,c.authCookies=a.authCookies,c.language=a.language,c.country=a.country,c}c(b,a);var d=e(b);return l(b,[{key:"signDocuments",value:function signDocuments(a,b,c){return this._genericPOST("/sign/pdf",{docs:this.parseDocs(a),getFileUrlPrefix:this.getFileUrlPrefix,getSignedFileUrlPrefix:this.getSignedFileUrlPrefix,putFileUrl:this.putFileUrl,authCookies:this.authCookies,language:this.language,country:this.country,signatureParams:c},b?b:"signingDoneMsg")}},{key:"signContainer",value:function signContainer(a,b,c){return this._genericPOST("/sign/container",{docs:this.parseDocs(a),getFileUrlPrefix:this.getFileUrlPrefix,getSignedFileUrlPrefix:this.getSignedFileUrlPrefix,putFileUrl:this.putFileUrl,authCookies:this.authCookies,language:this.language,country:this.country,signatureParams:c},b?b:"signingDoneMsg")}},{key:"parseDocs",value:function parseDocs(a){return"string"==typeof a?0<a.trim().length?a.split(","):[]:a}},{key:"chooseLocalFiles",value:function chooseLocalFiles(){return o(this.urlBase+"/sign/localFiles",{method:"POST",headers:{"content-type":"application/json"}})}}]),b}(s),v={getInstance:q.bind(null,"assinareIdApplet",t)};b.id=v;var w={getInstance:q.bind(null,"assinareSignApplet",u)};b.sign=w;var x={id:v,sign:w};b.default=x,self.assinare||(self.assinare=x)});
