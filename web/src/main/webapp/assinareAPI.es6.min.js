const a="Assinare Daemon/",b=/^2\.[0-7]\.\d{1,2}(?:-SNAPSHOT)?$/;function c(c){var d=c.headers.get("Server");if(d&&d.startsWith(a)){var e=d.substring(a.length);if(!b.test(e))throw new Error("Vers\xE3o incompat\xEDvel do Assinare Daemon detectada");else if(!c.ok){if(500===c.status)return c.json().then(a=>{console.log(a);var b=new Error(a.message);throw Object.assign(b,a),b});if(c.statusText)throw new Error(`Erro HTTP: ${c.status} - ${c.statusText}`);else throw new Error(`Erro HTTP: ${c.status}`)}else return c}else throw new Error("Assinare Daemon n\xE3o detectado")}function d(a,b){return fetch(a,b).catch(()=>{throw new Error("Falha de comunica\xE7\xE3o com o Assinare Daemon")}).then(c)}function e(a,b){return d(a,b).then(a=>a.json())}class f{constructor(){this.host="localhost",this.port=20666,this.urlBase=`https://${this.host}:${this.port}`}_genericPOST(a,b,c){var d;if(c)if("function"==typeof c)d=c;else if(d=window[c],"function"!=typeof d)throw new Error(`Function "${c.toString()}" not found on Window`);var f=e(this.urlBase+a,{method:"POST",body:JSON.stringify(b),headers:{"content-type":"application/json"}});return c?void f.then(a=>{console.log(a),d(!1,a)}).catch(a=>{console.error(a),d(a,null)}):f}getDaemonInfo(){return e(this.urlBase+"/info")}checkDaemonInfo(){return this.getDaemonInfo().then(()=>!0)}}class g extends f{constructor(a){super(a)}getCitizenData(a){return this._genericPOST("/id/data",{a:1},a)}getCitizenAddress(a){return this._genericPOST("/id/address",{a:1},a)}getCitizenPicture(a){return this._genericPOST("/id/picture",{a:1},a)}shutdown(a){return this._genericPOST("/shutdown",{a:1},a)}}class h extends f{constructor(a){super(a),this.getFileUrlPrefix=a.getFileUrlPrefix,this.getSignedFileUrlPrefix=a.getSignedFileUrlPrefix,this.putFileUrl=a.putFileUrl,this.authCookies=a.authCookies,this.language=a.language,this.country=a.country}signDocuments(a,b,c){return this._genericPOST("/sign/pdf",{docs:this.parseDocs(a),getFileUrlPrefix:this.getFileUrlPrefix,getSignedFileUrlPrefix:this.getSignedFileUrlPrefix,putFileUrl:this.putFileUrl,authCookies:this.authCookies,language:this.language,country:this.country,signatureParams:c},b?b:"signingDoneMsg")}signContainer(a,b,c){return this._genericPOST("/sign/container",{docs:this.parseDocs(a),getFileUrlPrefix:this.getFileUrlPrefix,getSignedFileUrlPrefix:this.getSignedFileUrlPrefix,putFileUrl:this.putFileUrl,authCookies:this.authCookies,language:this.language,country:this.country,signatureParams:c},b?b:"signingDoneMsg")}parseDocs(a){return"string"==typeof a?0<a.trim().length?a.split(","):[]:a}chooseLocalFiles(){return e(this.urlBase+"/sign/localFiles",{method:"POST",headers:{"content-type":"application/json"}})}}function i(a){return new Promise((b,c)=>{if(a.status<2)a.onLoad=b;else if(a.status==2)b();else{let b="Applet event handler not registered because applet status is: "+a.status;c(new Error(b))}})}function j(a,b,c,d){if(d&&"function"!=typeof d)throw new Error("Instantiation callback is not a function");const e=c[a],f=document.getElementById(e);let g;return g=e&&window.navigator.javaEnabled&&window.navigator.javaEnabled()&&f?i(f).then(()=>f):Promise.reject(!1),g=g.catch(a=>{a&&console.warn(a);var d=new b(c);return c.lazy?d:d.checkDaemonInfo().then(()=>d)}),d?void g.then(a=>{d(null,a)}).catch(a=>{d(a,null)}):g}const k={getInstance:j.bind(null,"assinareIdApplet",g)},l={getInstance:j.bind(null,"assinareSignApplet",h)},m={id:k,sign:l};export{k as id,l as sign,m as default};self.assinare||(self.assinare=m);
